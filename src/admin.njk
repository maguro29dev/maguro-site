---
title: "管理者用 通知送信パネル"
layout: "base.njk"
---

<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="bg-white p-8 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-6 text-gray-800">プッシュ通知送信</h1>
        
        <form id="notification-form" class="space-y-6">
            <div>
                <label for="title" class="block text-sm font-medium text-gray-700">通知タイトル</label>
                <input type="text" id="title" name="title" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            
            <div>
                <label for="body" class="block text-sm font-medium text-gray-700">通知本文</label>
                <textarea id="body" name="body" rows="3" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
            </div>

            <div>
                <label for="secret" class="block text-sm font-medium text-gray-700">秘密キー</label>
                <input type="password" id="secret" name="secret" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            
            <div>
                <button type="submit" id="send-button" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    通知を送信
                </button>
            </div>
        </form>

        <div id="status-message" class="mt-6 text-center text-sm"></div>
    </div>
</div>

<script>
    const form = document.getElementById('notification-form');
    const sendButton = document.getElementById('send-button');
    const statusMessage = document.getElementById('status-message');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const title = form.elements.title.value;
        const body = form.elements.body.value;
        const secret = form.elements.secret.value;

        // ボタンを無効化し、メッセージを更新
        sendButton.disabled = true;
        sendButton.textContent = '送信中...';
        statusMessage.textContent = '';
        statusMessage.className = 'mt-6 text-center text-sm';

        try {
            const response = await fetch('/.netlify/functions/send-push', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ title, body, secret }),
            });

            const result = await response.json();

            if (response.ok) {
                statusMessage.textContent = `成功: ${result.message}`;
                statusMessage.classList.add('text-green-600');
                form.reset(); // フォームをリセット
            } else {
                const errorMessage = result.error || '不明なエラーが発生しました。';
                throw new Error(`サーバーエラー (${response.status}): ${errorMessage}`);
            }

        } catch (error) {
            statusMessage.textContent = `失敗: ${error.message}`;
            statusMessage.classList.add('text-red-600');
        } finally {
            // ボタンを再度有効化
            sendButton.disabled = false;
            sendButton.textContent = '通知を送信';
        }
    });
</script>